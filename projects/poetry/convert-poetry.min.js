#!/usr/bin/env node
const fs=require("fs"),path=require("path"),folderPath=process.argv[2]||"./poetry";fs.existsSync(folderPath)||(console.error(`Error: Folder "${folderPath}" does not exist.`),console.log("Usage: node convert-poetry.js <poetry-folder-path>"),process.exit(1));const files=fs.readdirSync(folderPath).filter(e=>e.endsWith(".txt")).sort();0===files.length&&(console.error(`Error: No .txt files found in "${folderPath}"`),process.exit(1)),console.log(`Found ${files.length} poetry file(s):\n`);const poems=files.map((e,t)=>{const o=path.join(folderPath,e),s=fs.readFileSync(o,"utf-8"),r=path.basename(e,".txt").replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase()),l=s.split("\n");let n=r,a="",i=s;return l[0]&&l[0].trim().length>0&&l[0].trim().length<100&&(n=l[0].trim(),l[1]&&l[1].trim().match(/\d{4}|\w+\s+\d{4}/)?(a=l[1].trim(),i=l.slice(2).join("\n").trim()):i=l.slice(1).join("\n").trim()),console.log(`${t+1}. ${e}`),console.log(`   Title: ${n}`),a&&console.log(`   Date: ${a}`),console.log(""),{id:path.basename(e,".txt").toLowerCase().replace(/[^a-z0-9]/g,"-"),title:n,date:a||"Undated",content:i,filename:e}}),outputPath=path.join(path.dirname(folderPath),"poems.json");fs.writeFileSync(outputPath,JSON.stringify(poems,null,2),"utf-8"),console.log(`âœ“ Successfully created poems.json with ${poems.length} poem(s)`),console.log(`  Output: ${outputPath}`),console.log("\nNext step: Place poems.json in the same directory as your poetry-showcase.html file");